{% extends 'properties/base.html' %}

{% block title %}
Home - Vacation Rentals
{% endblock %}

{% block extra_css %}
<style>
    .hero {
        text-align: center;
        padding: 60px 20px;
        background: #ecf0f1;
        border-radius: 8px;
        margin-bottom: 40px;
    }

    .hero h2 {
        font-size: 2.5rem;
        margin-bottom: 20px;
        color: #2c3e50;
    }

    .hero p {
        font-size: 1.2rem;
        color: #7f8c8d;
        margin-bottom: 30px;
    }

    .search-form {
        max-width: 600px;
        margin: 0 auto;
        display: flex;
        gap: 10px;
        position: relative;
    }

    .search-form input {
        flex: 1;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }

    .search-form button {
        padding: 12px 30px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
    }

    .search-form button:hover {
        background: #2980b9;
    }

    .autocomplete-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        margin-right: 110px;
        background: white;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 4px 4px;
        max-height: 300px;
        overflow-y: auto;
        display: none;
        z-index: 1000;
    }

    .autocomplete-item {
        padding: 10px 12px;
        cursor: pointer;
        border-bottom: 1px solid #f0f0f0;
    }

    .autocomplete-item:hover {
        background: #f8f9fa;
    }

    .autocomplete-item:last-child {
        border-bottom: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="hero">
    <h2>Find Your Perfect Vacation Rental</h2>
    <p>Discover amazing properties around the world</p>

    <form
        action="{% url 'properties:property-list' %}"
        method="get"
        class="search-form">
        <input
            type="text"
            name="location"
            id="location-input"
            placeholder="Enter city, state or country..."
            autocomplete="off"
            required>

        <div
            id="autocomplete-dropdown"
            class="autocomplete-dropdown">
        </div>

        <button type="submit">Search</button>
    </form>
</div>

<script>
    const input = document.getElementById('location-input');
    const dropdown = document.getElementById('autocomplete-dropdown');
    let debounceTimer;

    input.addEventListener('input', function () {
        clearTimeout(debounceTimer);
        const query = this.value.trim();

        if (query.length < 2) {
            dropdown.style.display = 'none';
            return;
        }

        debounceTimer = setTimeout(() => {
            fetch(`/api/locations/?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.locations.length > 0) {
                        dropdown.innerHTML = data.locations
                            .map(
                                loc =>
                                    `<div class="autocomplete-item" data-value="${loc.city}">
                                        ${loc.text}
                                    </div>`
                            )
                            .join('');
                        dropdown.style.display = 'block';
                    } else {
                        dropdown.style.display = 'none';
                    }
                });
        }, 300);
    });

    dropdown.addEventListener('click', function (e) {
        if (e.target.classList.contains('autocomplete-item')) {
            input.value = e.target.dataset.value;
            dropdown.style.display = 'none';
        }
    });

    document.addEventListener('click', function (e) {
        if (!input.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.style.display = 'none';
        }
    });
</script>
{% endblock %}
